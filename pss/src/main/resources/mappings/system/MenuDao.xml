<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.nmw.pss.module.system.dao.MenuDao">
    <resultMap type="Menu" id="entityResult">
    	<id property="id" column="id"/>
    	<result property="createTime" column="create_time"/>
    	<result property="updateTime" column="update_time"/>
    	<result property="createUserId" column="create_user"/>
    	<result property="updateUserId" column="update_user"/>
    	<result property="remark" column="remark"/>
    	<result property="delSign" column="del_sign"/>
    	
    	<result property="name" column="name"/>
    	<result property="sort" column="sort"/>
    	<result property="url" column="url"/>
    	<result property="icon" column="icon"/>
    	<result property="parentId" column="parent_id"/>
    	<result property="permissions" column="permissions"/>
    	<result property="type" column="type"/>
    	<result property="level" column="level"/>
    	<result property="visible" column="visible"/>
    </resultMap>
    
	<insert id="insert">
		INSERT INTO menu(id, create_time, update_time, create_user, update_user, remark, del_sign,
			name, sort, url, icon, parent_id, permissions, type, level, visible) 
		VALUES (#{id}, #{createTime}, #{updateTime}, #{createUserId}, #{updateUserId}, #{remark}, #{delSign}, 
		#{name} ,#{sort} ,#{url} ,#{icon} ,#{parentId}, #{permissions}, #{type}, #{level}, #{visible})
	</insert>
	
	<delete id="deleteById">
		DELETE FROM menu WHERE id = #{id}
	</delete>
	
	<select id="selectById" resultMap="entityResult">
		SELECT 
			*
		FROM 
			menu 
		WHERE 
			id = #{id}
	</select>
	
	<update id="updateById">
		UPDATE menu 
		SET 
			update_time = #{updateTime}, 
			update_user = #{updateUserId}, 
			remark = #{remark}, 
			del_sign = #{delSign}, 
			
			name = #{name},
			sort = #{sort},
			url = #{url},
			icon = #{icon},
			parent_id = #{parentId},
			permissions = #{permissions},
			type = #{type},
			level = #{level},
			visible = #{visible}
		WHERE id = #{id}
	</update>
	
	<select id="selectByModel" resultMap="entityResult">
		SELECT 
			*
		FROM 
			menu 
		<where>
			del_sign=#{DEL_NORMAL}
			<if test="parentId != null and parentId != ''">
				AND parent_id=#{parentId}
			</if>
			ORDER BY level ASC, sort ASC
		</where>
	</select>
	
	<select id="selectAll" resultMap="entityResult">
		SELECT 
			*
		FROM 
			menu 
		<where>
			del_sign='1'
			AND id != '0'
		</where>
	</select>
	
	<!-- 查询当前节点的子节点 -->
	<select id="selectChildrenByModel" resultType="Menu">
		SELECT 
			m.id as id,
			m.create_time as createTime,
			m.update_time as updateTime,
			m.create_user as createUserId,
			m.update_user as updateUserId,
			m.remark as remark,
			m.del_sign as delSign,
			
			m.name as name,
			m.sort as sort,
			m.url as url,
			m.icon as icon,
			m.parent_id as parentId,
			m.permissions as permissions,
			m.type as type,
			m.level as level,
			m.visible as visible
		FROM
			employee e LEFT JOIN employee_role er on  e.id=er.employee_id
			LEFT JOIN role_menu rm ON er.role_id=rm.role_id
			LEFT JOIN menu m ON rm.menu_id=m.id
		<where>
			m.del_sign=#{DEL_NORMAL}
			<if test="employee != null">
				<if test="employee.id != null and employee.id != ''">
					AND e.id=#{employee.id}
				</if>
			</if>
			<if test="id != null and id != ''">
				AND m.parent_id=#{id}
			</if>
		</where>
		ORDER BY level ASC,sort ASC
	</select>
	
</mapper>